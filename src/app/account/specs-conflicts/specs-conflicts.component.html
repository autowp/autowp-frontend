<div class="page-header">
  <h1 i18n id="header">Conflicts</h1>
</div>

@if (user$ | async; as user) {
  @if (user.specsWeight !== null) {
    <p class="float-end"><ng-container i18n>Weight</ng-container>: {{ user.specsWeight.toFixed(2) }}</p>
  }
} @else {
  <div class="spinner-border" role="status"><span class="visually-hidden" i18n>Loading…</span></div>
}

@if (filter$ | async; as filter) {
  <div class="nav nav-pills mb-3">
    <a
      class="nav-link"
      [class.active]="filter === '0'"
      routerLink="."
      [queryParams]="{filter: 0}"
      queryParamsHandling="merge"
      i18n
      >All</a
    >
    <a
      class="nav-link"
      [class.active]="filter === '-1'"
      routerLink="."
      [queryParams]="{filter: -1}"
      queryParamsHandling="merge"
      i18n
      >I disagree</a
    >
    <a
      class="nav-link"
      [class.active]="filter === '1'"
      routerLink="."
      [queryParams]="{filter: 1}"
      queryParamsHandling="merge"
      i18n
      >Do not agree with me</a
    >
    <a
      class="nav-link"
      [class.active]="filter === 'minus-weight'"
      routerLink="."
      [queryParams]="{filter: 'minus-weight'}"
      queryParamsHandling="merge"
      i18n
      >Errors</a
    >
  </div>
} @else {
  <div class="spinner-border" role="status"><span class="visually-hidden" i18n>Loading…</span></div>
}

@if (data$ | async; as data) {
  <table class="table" aria-describedby="header">
    <thead>
      <tr>
        <th i18n scope="col">Object</th>
        <th i18n scope="col">Parameter</th>
        <th i18n scope="col">My value</th>
        <th i18n scope="col">Other values</th>
      </tr>
    </thead>
    <tbody>
      @for (conflict of data.conflicts; track conflict) {
        <tr>
          <td [textContent]="conflict.object"></td>
          <td [textContent]="conflict.attribute"></td>
          <td>
            @for (value of conflict.values; track value) {
              @if (!value.user$) {
                <div>
                  @if (value.value === null) {
                    <em i18n>none</em>
                  }
                  @if (value.value !== null) {
                    <span>
                      {{ value.value }}
                      @if (conflict.unit) {
                        <span>{{ getUnitAbbrTranslation(conflict.unit.id + '') }}</span>
                      }
                    </span>
                  }
                  <a routerLink="/cars/specifications-editor" [queryParams]="{item_id: conflict.item_id}">
                    <i class="bi bi-pencil-fill" aria-hidden="true"></i>
                  </a>
                </div>
              }
            }
          </td>
          <td>
            @for (value of conflict.values; track value) {
              @if (value.user$) {
                <div>
                  @if (value.value === null) {
                    <em i18n>none</em>
                  }
                  @if (value.value !== null) {
                    <span>
                      {{ value.value }}
                      @if (conflict.unit) {
                        <span>{{ getUnitAbbrTranslation(conflict.unit.id + '') }}</span>
                      }
                    </span>
                  }
                  @if (value.user$ | async; as user) {
                    <app-user [user]="user"></app-user>
                  } @else {
                    <div class="spinner-border" role="status"><span class="visually-hidden" i18n>Loading…</span></div>
                  }
                </div>
              }
            }
          </td>
        </tr>
      }
    </tbody>
  </table>

  @if (data.paginator) {
    <app-paginator [data]="data.paginator"></app-paginator>
  }
} @else {
  <div class="spinner-border" role="status"><span class="visually-hidden" i18n>Loading…</span></div>
}
