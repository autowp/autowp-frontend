<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item">
      <a routerLink="/" i18n>Index page</a>
    </li>
    <li class="breadcrumb-item">
      <a routerLink="/moder" i18n>Moderator page</a>
    </li>
    <li class="breadcrumb-item">
      <a routerLink="/moder/attrs" i18n>Attributes</a>
    </li>
  </ol>
</nav>

<div class="page-header" *ngIf="attribute$|async as attribute">
  <h1>{{attribute.name}}</h1>
</div>

<div class="row" *ngIf="attributes$|async as attributes">
  <div class="col-md-6">
    <h2>
      <span i18n>Attribute parameters</span>
      <span [hidden]="loading <= 0">
        <i class="fa fa-spinner fa-spin fa-fw" aria-hidden="true"></i>
      </span>
    </h2>
    <div class="card card-body mb-4">
      <form class="form-vertical" (submit)="saveAttribute(attribute)" *ngIf="attribute$|async as attribute">
        <div class="mb-3">
          <label i18n>Name</label>
          <input type="text" name="name" class="form-control" [(ngModel)]="attribute.name" />
        </div>
        <div class="mb-3">
          <label i18n>Type</label>
          <select name="type_id" class="form-control" [(ngModel)]="attribute.type_id">
            <option *ngFor="let option of typeOptions$|async" [ngValue]="option.id">{{option.name}}</option>
          </select>
        </div>
        <div class="mb-3">
          <label i18n>Precision (for float attribute)</label>
          <input type="text" name="precision" class="form-control" [(ngModel)]="attribute.precision">
        </div>
        <div class="mb-3">
          <label i18n>Unit</label>
          <select name="unit_id" class="form-control" [(ngModel)]="attribute.unit_id">
            <option *ngFor="let option of unitOptions$|async" [ngValue]="option.id">{{option.name}}</option>
          </select>
        </div>
        <div class="mb-3">
          <label i18n>Description</label>
          <textarea name="description" class="form-control" [(ngModel)]="attribute.description"></textarea>
        </div>
        <button type="submit" class="btn btn-primary" i18n>send</button>
      </form>
    </div>

    <h2 i18n>Values list (for select)</h2>
    <div class="card card-body mb-4">
      <app-moder-attrs-attribute-list-options-tree [items]="listOptions$|async"></app-moder-attrs-attribute-list-options-tree>
    </div>

    <h2>
      <span i18n>Add value</span>
      <span [hidden]="addListOptionLoading <= 0">
        <i class="fa fa-spinner fa-spin fa-fw" aria-hidden="true"></i>
      </span>
    </h2>
    <div class="card card-body mb-4" *ngIf="attribute$|async as attribute">
      <form class="form-vertical" (submit)="addListOption(attribute)">
        <div class="mb-3">
          <label i18n>Parent</label>
          <select name="parent_id" class="form-control" [(ngModel)]="newListOption.parent_id">
            <option *ngFor="let option of listOptionsOptions" [ngValue]="option.id">{{option.name}}</option>
          </select>
        </div>
        <div class="mb-3">
          <label i18n>Name</label>
          <input type="text" name="name" class="form-control" [(ngModel)]="newListOption.name" />
        </div>
        <button type="submit" name="submit" class="btn btn-primary" i18n>send</button>
      </form>
    </div>
  </div>
  <div class="col-md-6" *ngIf="attributes$|async as attributes">
    <div *ngIf="attributes.items.length > 0">
      <h2 i18n id="header">Attributes</h2>
      <div class="card card-body mb-4" *ngIf="typeMap$|async as typeMap">
        <table class="table" aria-describedby="header">
          <tr>
            <th i18n scope="col">Name</th>
            <th i18n scope="col">Type</th>
            <th i18n scope="col">Unit</th>
          </tr>
          <tr *ngFor="let attribute of attributes.items">
            <td>
              <a [routerLink]="['/moder/attrs/attribute', attribute.id]" [textContent]="getAttrsTranslation(attribute.name)"></a>
            </td>
            <td>
              <span *ngIf="attribute.type_id" [textContent]="typeMap[attribute.type_id]"></span>
              <span *ngIf="!attribute.type_id">—</span>
            </td>
            <td>
              <span *ngIf="attribute.unit" [textContent]="getUnitTranslation(attribute.unit.id, 'name')"></span>
              <span *ngIf="!attribute.unit">—</span>
            </td>
          </tr>
        </table>
      </div>
    </div>

    <h2>
      <span i18n>Add subattribute</span>
      <span [hidden]="addLoading <= 0">
        <i class="fa fa-spinner fa-spin fa-fw" aria-hidden="true"></i>
      </span>
    </h2>
    <div class="card card-body mb-4">
      <form class="form-vertical" (submit)="addAttribute(attribute)" *ngIf="attribute$|async as attribute">
        <div class="mb-3">
          <label i18n>Name</label>
          <input type="text" name="name" class="form-control" [(ngModel)]="newAttribute.name" />
        </div>
        <div class="mb-3">
          <label i18n>Type</label>
          <select name="type_id" class="form-control" [(ngModel)]="newAttribute.type_id">
            <option *ngFor="let option of typeOptions$|async" [value]="option.id">{{option.name}}</option>
          </select>
        </div>
        <div class="mb-3">
          <label i18n>Precision (for float attribute)</label>
          <input type="text" name="precision" class="form-control" [(ngModel)]="newAttribute.precision">
        </div>
        <div class="mb-3">
          <label i18n>Unit</label>
          <select name="unit_id" class="form-control" [(ngModel)]="newAttribute.unit_id">
            <option *ngFor="let option of unitOptions$|async" [value]="option.id">{{option.name}}</option>
          </select>
        </div>
        <div class="mb-3">
          <label i18n>Description</label>
          <textarea name="description" class="form-control" [(ngModel)]="newAttribute.description"></textarea>
        </div>
        <button type="submit" class="btn btn-primary" i18n>send</button>
      </form>
    </div>
  </div>
</div>
